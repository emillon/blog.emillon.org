<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Enter the void * - Santa made me learn Rails in a week</title>
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="../css/extra.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="alternate" type="application/rss+xml" title="Enter the void *" href="../rss.xml" />
        <link rel="shortcut icon" href="../favicon.ico" />
        <link href="http://fonts.googleapis.com/css?family=Merriweather:400,300" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div class="header container">
            <h1 class="maintitle">Enter the void *</h1>
               <div class="nav-hdr">
                   <ul>
                      <li><a href="../">Home</a></li>
                      <li><a href="../posts.html">All posts</a></li>
                      <li><a href="../rss.xml">Feed</a></li>
                      <li><a href="https://github.com/emillon">Github</a></li>
                      <li><a href="https://qa.debian.org/developer.php?login=me%40emillon.org">Debian</a></li>
                      <li><a href="https://twitter.com/etiennemillon">Twitter</a></li>
                   </ul>
                </div>
        </div>
        <div class="maincontainer container">
          <div class="col-md-8 col-md-offset-2">
            <h1>Santa made me learn Rails in a week</h1>

<p>by <em>Etienne Millon</em> on <strong>April  3, 2015</strong></p>

<p>Tagged as: <a title="All pages tagged 'rails'." href="../tags/rails.html">rails</a>, <a title="All pages tagged 'secretsanta'." href="../tags/secretsanta.html">secretsanta</a>.</p>

<p><strong>Abstract:</strong> <em>I released <a href="https://secretsantacreator.herokuapp.com/">Secret Santa Creator</a>, a free website to organize
events where every participant makes a gift to a random other one. To do that I
learnt Ruby on Rails in a week and it was awesome. As usual I put <a href="https://github.com/emillon/secret-santa">the source on
Github</a>.</em></p>
<hr />
<p>Every year I take part in Secret Santa: within a group of friends, everyone has
a “target” to whom he has to make a gift.</p>
<p>There are several techniques to organize that. The simplest one is to have
anyone put their name in a hat, shuffle everything, and have everyone pick one
name. But to do that, you need to put everyone in the same room before the event
and that is not always convenient. Another possibility is to ask someone to pick
the names, but he will know who has to make a gift to him.</p>
<p>So last year, I decided to script this. I made a small python script that takes
a list of names and emails, shuffles them and sends email to the correct
persons. It worked well. Technically, I could know who was supposed to make me a
gift by watching my mail logs, but short of sophisticated cryptographic
protocols, you have to trust the organizer not to cheat anyway.</p>
<p>In a way, this was a good MVP; but it was not very reusable. Indeed, some
friends asked me the program so that they could use it with other friends, but I
could not expect everybody to have python and sendmail installed on their
machines. To cover their needs, it turns out that there are a lot of websites
that offer this service, so I ended up pointing them to these websites.</p>
<p>This year, I was asked again about how to organize a Secret Santa, so I figured,
why not build a website? This had the opportunity to be directly useful to my
friends, so I jumped in. Plus, this was a good excuse to learn new technologies.
I gave myself one week to learn Ruby on Rails, code the website and deploy it on
Heroku. That is what the cool kids do, right?</p>
<p>My web stack of choice usually revolves around Flask, which is simple and
powerful, but it does not do a lot of things out of the box. That is one the
strengths of this microframework, but I wanted to try something more integrated.
Django would have been a good choice too, but I was curious about Ruby on Rails
and the Ruby ecosystem in general.</p>
<p>I had bookmarked the <a href="https://www.railstutorial.org/book">Ruby on Rails Tutorial</a> by Michael Hartl, which seemed a
good resource. Indeed, it is very nice, seems it is up to date and emphasizes
not only on the code but also on how to deploy a project, or even how to keep a
project under source control. When you learn a new technology, it is not obvious
which files should get checked in. If you asked me before, I would probably have
put <code>Gemfile.lock</code> out of git.</p>
<p>The book uses particular versions of the different gems, so this has been tested
and works flawlessly. At first I was afraid to have to use rvm, which I heard
does not work too well. I prefer using a ruby interpreter provided by my
distribution, but I am OK with using third-party gems. That is my policy for
Python too: I use a system python and a virtualenv for each project. Ruby’s
bundler seems to work like this.</p>
<p>I was very pleased by the first chapter of the book which explains how to write
a minimal rails site and immediately deploying it to Heroku. I found it
astonishing that to do that, absolutely zero configuration was needed. That is
in part thanks to Rails’ <a href="https://en.wikipedia.org/wiki/Convention_over_configuration">Convention over Configuration</a> philosophy and in part
because Heroku is made for Rails app by default.</p>
<p>By contrast, to deploy a Flask app these days on a server I control, I have to
write an Ansible playbook. Mostly copy &amp; pasted from previous projects but
still, the friction is incomparable. This is not specific to Rails though, so I
may use Heroku for Python one-off projects too now.</p>
<p>The rest of the book focuses on creating a microblog site, first using the
scaffold technique and then by hand.</p>
<p>I liked that there is a lot of structure in Rails application: everything has a
“correct place” and there is a clear separation between everything. Even tests
are automatically separated into different folders. Also, I have not created a
single <code>.rb</code> file by hand; everything was created by <code>rails generate</code>. This is
the sweet spot between having to do everything by hand and coding in an IDE.</p>
<p>As for the Ruby language itself, I figured that I would learn it on the fly
since it is similar enough to Python. That worked out well.</p>
<p>I like the <code>:symbols</code> a lot, they remind me of Lisp. It makes a clear
distinction between strings used as keys and strings that are meant to be
printed. I am not a fan of the colon syntax itself, especially when they are
mixed with hashes (<code>k: :v</code>) but syntax highlighting helps in that case of
course.</p>
<p>The concrete syntax is a bit weird. I like the explicit <code>end</code>, but I am still
not sure whether whitespace is significant. Same goes for expressions: it is a
bit unclear when parentheses are needed. I think that it is the same as in
Coffeescript. I hope that it is not ambiguous and that bugs arising from that
are rare.</p>
<p>That should be covered by tests anyway. The book encourages to write a lot of
tests, which is quite nice. The testing ecosystem is interesting, particularly
minitest and guard, which make TDD very easy. Guard is a bit too aggressive,
which means that it will sometimes not run all the needed tests. This is
probably just a matter of writing a better <code>Guardfile</code>.</p>
<p>Anyway, I went through chapters 1 to 9 and it was enough to get a good grasp of
how to code a Rails site.</p>
<p>The website I wanted to write would work like this:</p>
<ul>
<li>go to the homepage;</li>
<li>create a new event;</li>
<li>fill in info: names, emails, constraints;</li>
<li>click send;</li>
<li>emails are sent.</li>
</ul>
<p>It is actually a bit more complicated since it also handles edition, but overall
it is a very simple website. With the Rails Tutorial almost done I had enough to
build it. Actually, Secret Santa Creator is even simpler since it does not
require authentication. I did it mostly using Test-Driven Development, as in the
tutorial.</p>
<p>The hardest part was definitely creating nested forms. Every event has a list of
participants, and a list of constraints. It is thus necessary to create a form
that can edit this list structure, by directly editing participants or
constraints from the “edit event” form, but also removing or adding some.</p>
<p>I found the <a href="https://github.com/nathanvda/cocoon">cocoon</a> gem which works fine for this, and I could build this kind
of form:</p>
<figure>
<img src="2015-04-03-santa-made-me-learn-rails-in-a-week/nested.png" alt="Nested forms with cocoon" />
<figcaption aria-hidden="true">Nested forms with cocoon</figcaption>
</figure>
<p>To send email in my Python script MVP, I just piped stuff to <code>sendmail</code>.
Fortunately, Ruby on Rails has an integrated system to do that, with Action
Mailer. You just need to setup SMTP configuration and write <code>rails generate mailer</code> and boom, you can send emails. Heroku has a plugin for sendgrid with a
reasonable free tier, so I used that.</p>
<p>Coding the actual website took approximately two days. It is possible to be that
fast only because Rails insists that easy tasks should become no-brainers.</p>
<p>You can see the site <a href="https://secretsantacreator.herokuapp.com/">here</a> and <a href="https://github.com/emillon/secret-santa">the source on Github</a>.</p>
<p>It works reasonably fine, barring a few quirks in the UI. I used it myself to
organize several events this year, and a couple friends did the same. I would
call that a success! I plan to work a bit more on it at the end of the year and
try to get a little more users. I am curious to see how it goes!</p>



          </div>
        </div>
        <div class="footer container">
            <p>
                I love feedback! Feel free to catch me on twitter
                (<a href="https://twitter.com/etiennemillon">@etiennemillon</a>)
                or drop me mail (me AT emillon DOT org).
            </p>
        </div>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-51676253-1', 'emillon.org');
          ga('send', 'pageview');

        </script>
    </body>
</html>
